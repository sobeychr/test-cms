---
import DefaultLayout from '@layouts/Default.astro';
import { ToggleSlide } from '@components/toggleslide/ToggleSlide';
import { COOKIE_DARK_NAME } from '@utils/configs';

const isLight = Astro.cookies.get(COOKIE_DARK_NAME)?.value === '0';
---

<DefaultLayout>
  <h1>User configs</h1>
  <form>
    <fieldset>
      <legend>Display</legend>
      <ToggleSlide
        client:visible="solid-js"
        defaultChecked={!isLight}
        name="darkmode"
        label="Dark Mode"
        onChange="onChangeDarkMode"
      />
    </fieldset>
  </form>
</DefaultLayout>

<script>
  import { COOKIE_DARK_DURATION, COOKIE_DARK_NAME } from '@utils/configs';
  import { setCookie } from '@utils/cookie';

  (function () {
    const onChangeDarkMode = ({ after }) => {
      const value = after ? 1 : 0;
      setCookie(COOKIE_DARK_NAME, value, { maxAge: COOKIE_DARK_DURATION });

      const func = value ? 'remove' : 'add';
      document.querySelector('html')?.classList[func]('light');
    };

    window.onChangeDarkMode = onChangeDarkMode;
  })();
</script>
